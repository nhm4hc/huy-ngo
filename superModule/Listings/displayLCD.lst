C51 COMPILER V9.60.0.0   DISPLAYLCD                                                        12/10/2023 14:32:25 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE DISPLAYLCD
OBJECT MODULE PLACED IN .\Objects\displayLCD.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE displayLCD.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\displayLCD.lst) TABS(2) OBJECT(.\Objects\displayLCD.obj)

line level    source

   1          #include "displayLCD.h"
   2          #include "LCD1602.h"
   3          #include "module_7.h"
   4          #include "module_8.h"
   5          #include "module_9.h"
   6          #include "module_11.h"
   7          
   8          void IrInit(void){
   9   1        checkRun = 0;
  10   1        module = 0;
  11   1        IT0 = 1;
  12   1        EX0 = 1;
  13   1        EA = 1; 
  14   1        IRIN = 1;
  15   1      }
  16          
  17          void DelayMs(unsigned int x){
  18   1        unsigned char i;
  19   1        while(x--)
  20   1        {
  21   2          for (i = 0; i<13; i++){}
  22   2        }
  23   1      }
  24          
  25          void ReadIr(void) interrupt 0 {
  26   1        unsigned char j,k;
  27   1        unsigned int err;
  28   1        Time=0;          
  29   1        DelayMs(70); //Goi ham delay de tao do tre 70ms
  30   1        if(IRIN==1) //Kiem tra xem tin hieu hong ngoai co dang nhan duoc khong  
  31   1        { 
  32   2          err=1000; //Dat 1 gia tri timeout 
  33   2          while((IRIN==0)&&(err>0)) //wait den khi TRIN len muc 1 hoac timeout
  34   2          {     
  35   3            DelayMs(1);
  36   3            err--;
  37   3          } 
  38   2          if(IRIN==1) //Neu tin hieu len muc 1    
  39   2          {
  40   3            err=500;
  41   3            while((IRIN==1)&&(err>0))// Wait cho den khi TRIN xuong muc 0 hoac timeout     
  42   3            {
  43   4              DelayMs(1);
  44   4              err--;
  45   4            }
  46   3            for(k=0;k<4;k++) //Nhan 1 byte du lieu
  47   3            {       
  48   4              for(j=0;j<8;j++) //Nhan 8 bitt du lieu  
  49   4              {
  50   5                err=60;   
  51   5                while((IRIN==0)&&(err>0)) // Wait cho den khi TRIN xuong muc 1 hoac timeout
  52   5                {
  53   6                  DelayMs(1);
  54   6                  err--;
C51 COMPILER V9.60.0.0   DISPLAYLCD                                                        12/10/2023 14:32:25 PAGE 2   

  55   6                }
  56   5                err=500;
  57   5                while((IRIN==1)&&(err>0)) // Wait cho den khi TRIN xuong muc 0 hoac timeout 
  58   5                {
  59   6                  DelayMs(1);
  60   6                  Time++;
  61   6                  err--;
  62   6                  if(Time>30) //Neu thoi gian TRIN o muc 1 qua 30ms
  63   6                  {
  64   7                    EX0=1; //Cho ph?p ngat ngoai vi
  65   7                    return; //Thoat khoi ham ngat
  66   7                  }
  67   6                }
  68   5                IrValue[k]>>=1; //bitt 0 se duoc day vao bitt cao nhat cua IrValue[k] 
  69   5                if(Time>=8) //Neu thoi gian TRIN muc cao lon hon 8ms    
  70   5                {
  71   6                  IrValue[k]|=0x80; //bitt 1 se duoc day vao bitt cao nhat cua IrValue[k] 
  72   6                }
  73   5                Time=0; // set time ve 0              
  74   5              }
  75   4            }
  76   3          }
  77   2          if(IrValue[2]!=~IrValue[3]) //Kiem tra tinh nhat quan cua du lieu
  78   2          {
  79   3            return;
  80   3          }
  81   2        }     
  82   1      }
  83          
  84          void hienThiChuc(int x){
  85   1        LcdWriteCom(0x80+0x09);
  86   1        LcdWriteData(x+0x30); 
  87   1      }
  88          
  89          void hienThiDonVi(int x){
  90   1        LcdWriteCom(0x80+0x0a);
  91   1        LcdWriteData(x+0x30); 
  92   1      }
  93            
  94          void reset(void){
  95   1        int i;
  96   1        checkRun = 0;
  97   1        IrValue[2] = 0;
  98   1        module = 0;
  99   1        hienThiDonVi(0x6B);
 100   1        hienThiChuc(0x6B);  
 101   1        LcdWriteCom(0x80+0x40);
 102   1        for(i=0;i<9;i++)
 103   1        {
 104   2          LcdWriteData(CDIS2[i]); 
 105   2        }
 106   1      }
 107          
 108          void xuLi(int x){
 109   1        if(checkRun==0)
 110   1        {
 111   2          module = x*10 + module;
 112   2          hienThiChuc(x);
 113   2          checkRun = 1;
 114   2          IrValue[2] = 0;
 115   2        }
 116   1        else if(checkRun==1)
C51 COMPILER V9.60.0.0   DISPLAYLCD                                                        12/10/2023 14:32:25 PAGE 3   

 117   1        {
 118   2          module = x + module;
 119   2          hienThiDonVi(x);
 120   2          checkRun =3;
 121   2          IrValue[2] = 0;
 122   2        }
 123   1      }
 124          
 125          void runModule(int x){
 126   1        switch (x) 
 127   1        {
 128   2          case 1:
 129   2              // Tr?ng
 130   2              break;
 131   2          case 2:
 132   2              // Tr?ng
 133   2              break;
 134   2          case 3:
 135   2              // Tr?ng
 136   2              break;
 137   2          case 4:
 138   2              // Tr?ng
 139   2              break;
 140   2          case 5:
 141   2              // Tr?ng
 142   2              break;
 143   2          case 6:
 144   2              // Tr?ng
 145   2              break;
 146   2          case 7:
 147   2              //LCD12864_DrowPic(&ars);
 148   2              break;
 149   2          case 8:
 150   2              module_8();
 151   2              break;
 152   2          case 9:
 153   2              module_9();
 154   2              break;
 155   2          case 10:
 156   2              // Tr?ng
 157   2              break;
 158   2          case 11:
 159   2              module_11();
*** WARNING C206 IN LINE 159 OF displayLCD.c: 'module_11': missing function-prototype
 160   2              break;
 161   2          case 12:
 162   2              // Tr?ng
 163   2              break;
 164   2          case 13:
 165   2              // Tr?ng
 166   2              break;
 167   2          case 14:
 168   2              // Tr?ng
 169   2              break;
 170   2          case 15:
 171   2              // Tr?ng
 172   2              break;
 173   2          case 16:
 174   2              // Tr?ng
 175   2              break;
 176   2          case 17:
 177   2              // Tr?ng
C51 COMPILER V9.60.0.0   DISPLAYLCD                                                        12/10/2023 14:32:25 PAGE 4   

 178   2              break;
 179   2          case 18:
 180   2              // Tr?ng
 181   2              break;
 182   2          case 19:
 183   2              // Tr?ng
 184   2              break;
 185   2          case 20:
 186   2              // Tr?ng
 187   2              break;
 188   2          default:
 189   2              reset();
 190   2              break;
 191   2        }
 192   1      }
 193          
 194          void displayLCD(void){
 195   1        unsigned char i;
 196   1        LcdWriteCom(0x80); 
 197   1        for(i=0;i<9;i++)
 198   1        {
 199   2          LcdWriteData(CDIS1[i]); 
 200   2        }
 201   1        LcdWriteCom(0x80+0x40);
 202   1        for(i=0;i<9;i++)
 203   1        {
 204   2          LcdWriteData(CDIS2[i]); 
 205   2        }
 206   1      }
 207          
 208          void signalRecieved(void){
 209   1        unsigned char i;
 210   1        IrValue[4]=IrValue[2]>>4;
 211   1        IrValue[5]=IrValue[2]&0x0f; 
 212   1        if(IrValue[4]==0x00 && IrValue[5]==0x0D)
 213   1        {     //0   0D
 214   2          nutBam = 0;
 215   2          xuLi(nutBam);
 216   2        }
 217   1        if(IrValue[4]==0x00 && IrValue[5]==0x0C)
 218   1        { //1   0C  
 219   2          nutBam = 1;
 220   2          xuLi(nutBam);
 221   2        }
 222   1        if(IrValue[4]==0x01 && IrValue[5]==0x08)
 223   1        {   //2   18
 224   2          nutBam = 2;
 225   2          xuLi(nutBam);
 226   2        }
 227   1        if(IrValue[4]==0x05 && IrValue[5]==0x0E)
 228   1        {   //3   5E
 229   2          nutBam = 3;
 230   2          xuLi(nutBam);
 231   2        }
 232   1        if(IrValue[4]==0x00 && IrValue[5]==0x08)
 233   1        {     //4   08
 234   2          nutBam = 4;
 235   2          xuLi(nutBam);
 236   2        }
 237   1        if(IrValue[4]==0x01 && IrValue[5]==0x0C)
 238   1        { //5   1C  
 239   2          nutBam = 5;
C51 COMPILER V9.60.0.0   DISPLAYLCD                                                        12/10/2023 14:32:25 PAGE 5   

 240   2          xuLi(nutBam);
 241   2        }
 242   1        if(IrValue[4]==0x05 && IrValue[5]==0x0A)
 243   1        {   //6   5A
 244   2          nutBam = 6;
 245   2          xuLi(nutBam);
 246   2        }
 247   1        if(IrValue[4]==0x04 && IrValue[5]==0x02)
 248   1        {   //7   42
 249   2          nutBam = 7;
 250   2          xuLi(nutBam);
 251   2        }
 252   1        if(IrValue[4]==0x05 && IrValue[5]==0x02)
 253   1        {     //8   52
 254   2          nutBam = 8;
 255   2          xuLi(nutBam);
 256   2        }
 257   1        if(IrValue[4]==0x04 && IrValue[5]==0x0A)
 258   1        { //9   4A
 259   2          nutBam = 9;
 260   2          xuLi(nutBam);
 261   2        }
 262   1        
 263   1        if(IrValue[4]==0x04 && IrValue[5]==0x04)
 264   1        {   //mode    44H
 265   2          if(module < 20)
 266   2          {
 267   3            runModule(module);
 268   3          }
 269   2          else
 270   2          {
 271   3            LcdWriteCom(0x80+0x40);
 272   3            for(i=0;i<9;i++)
 273   3            {
 274   4              LcdWriteData(CDIS4[i]); 
 275   4            }
 276   3            DelayMs(7000);
 277   3          }
 278   2          //reset();
 279   2        }
 280   1        if(IrValue[4]==0x04 && IrValue[5]==0x06)
 281   1        {   //stop    46H
 282   2          LcdWriteCom(0x80+0x40);
 283   2          for(i=0;i<9;i++)
 284   2          {
 285   3            LcdWriteData(CDIS2[i]); //Hien thi 'IR-CODE:--H' len LCD
 286   3          }
 287   2          IrValue[2] = 0;
 288   2        }
 289   1        
 290   1        if(IrValue[4]==0x04 && IrValue[5]==0x05)
 291   1        {   //nguon   45H
 292   2          reset();
 293   2        }
 294   1      }
 295          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    954    ----
   CONSTANT SIZE    =   1086    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V9.60.0.0   DISPLAYLCD                                                        12/10/2023 14:32:25 PAGE 6   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
