C51 COMPILER V9.60.0.0   DISPLAYLCD                                                        12/10/2023 13:06:45 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE DISPLAYLCD
OBJECT MODULE PLACED IN .\Objects\displayLCD.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE displayLCD.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\displayLCD.lst) TABS(2) OBJECT(.\Objects\displayLCD.obj)

line level    source

   1          #include "displayLCD.h"
   2          #include "LCD1602.h"
   3          #include "module_8.h"
   4          
   5          void IrInit(void){
   6   1        checkRun = 0;
   7   1        module = 0;
   8   1        IT0 = 1;
   9   1        EX0 = 1;
  10   1        EA = 1; 
  11   1        IRIN = 1;
  12   1      }
  13          
  14          void DelayMs(unsigned int x){
  15   1        unsigned char i;
  16   1        while(x--)
  17   1        {
  18   2          for (i = 0; i<13; i++){}
  19   2        }
  20   1      }
  21          
  22          void ReadIr(void) interrupt 0 {
  23   1        unsigned char j,k;
  24   1        unsigned int err;
  25   1        Time=0;          
  26   1        DelayMs(70); //Goi ham delay de tao do tre 70ms
  27   1        if(IRIN==1) //Kiem tra xem tin hieu hong ngoai co dang nhan duoc khong  
  28   1        { 
  29   2          err=1000; //Dat 1 gia tri timeout 
  30   2          while((IRIN==0)&&(err>0)) //wait den khi TRIN len muc 1 hoac timeout
  31   2          {     
  32   3            DelayMs(1);
  33   3            err--;
  34   3          } 
  35   2          if(IRIN==1) //Neu tin hieu len muc 1    
  36   2          {
  37   3            err=500;
  38   3            while((IRIN==1)&&(err>0))// Wait cho den khi TRIN xuong muc 0 hoac timeout     
  39   3            {
  40   4              DelayMs(1);
  41   4              err--;
  42   4            }
  43   3            for(k=0;k<4;k++) //Nhan 1 byte du lieu
  44   3            {       
  45   4              for(j=0;j<8;j++) //Nhan 8 bitt du lieu  
  46   4              {
  47   5                err=60;   
  48   5                while((IRIN==0)&&(err>0)) // Wait cho den khi TRIN xuong muc 1 hoac timeout
  49   5                {
  50   6                  DelayMs(1);
  51   6                  err--;
  52   6                }
  53   5                err=500;
  54   5                while((IRIN==1)&&(err>0)) // Wait cho den khi TRIN xuong muc 0 hoac timeout 
C51 COMPILER V9.60.0.0   DISPLAYLCD                                                        12/10/2023 13:06:45 PAGE 2   

  55   5                {
  56   6                  DelayMs(1);
  57   6                  Time++;
  58   6                  err--;
  59   6                  if(Time>30) //Neu thoi gian TRIN o muc 1 qua 30ms
  60   6                  {
  61   7                    EX0=1; //Cho ph?p ngat ngoai vi
  62   7                    return; //Thoat khoi ham ngat
  63   7                  }
  64   6                }
  65   5                IrValue[k]>>=1; //bitt 0 se duoc day vao bitt cao nhat cua IrValue[k] 
  66   5                if(Time>=8) //Neu thoi gian TRIN muc cao lon hon 8ms    
  67   5                {
  68   6                  IrValue[k]|=0x80; //bitt 1 se duoc day vao bitt cao nhat cua IrValue[k] 
  69   6                }
  70   5                Time=0; // set time ve 0              
  71   5              }
  72   4            }
  73   3          }
  74   2          if(IrValue[2]!=~IrValue[3]) //Kiem tra tinh nhat quan cua du lieu
  75   2          {
  76   3            return;
  77   3          }
  78   2        }     
  79   1      }
  80          
  81          void hienThiChuc(int x){
  82   1        LcdWriteCom(0x80+0x09);
  83   1        LcdWriteData(x+0x30); 
  84   1      }
  85          
  86          void hienThiDonVi(int x){
  87   1        LcdWriteCom(0x80+0x0a);
  88   1        LcdWriteData(x+0x30); 
  89   1      }
  90            
  91          void reset(void){
  92   1        int i;
  93   1        checkRun = 0;
  94   1        IrValue[2] = 0;
  95   1        module = 0;
  96   1        hienThiDonVi(0x6B);
  97   1        hienThiChuc(0x6B);  
  98   1        LcdWriteCom(0x80+0x40);
  99   1        for(i=0;i<9;i++)
 100   1        {
 101   2          LcdWriteData(CDIS2[i]); 
 102   2        }
 103   1      }
 104          
 105          void xuLi(int x){
 106   1        if(checkRun==0)
 107   1        {
 108   2          module = x*10 + module;
 109   2          hienThiChuc(x);
 110   2          checkRun = 1;
 111   2          IrValue[2] = 0;
 112   2        }
 113   1        else if(checkRun==1)
 114   1        {
 115   2          module = x + module;
 116   2          hienThiDonVi(x);
C51 COMPILER V9.60.0.0   DISPLAYLCD                                                        12/10/2023 13:06:45 PAGE 3   

 117   2          checkRun =3;
 118   2          IrValue[2] = 0;
 119   2        }
 120   1      }
 121          
 122          void runModule(int x){
 123   1        switch (x) 
 124   1        {
 125   2          case 1:
 126   2            // Tr?ng
 127   2            break;
 128   2          case 2:
 129   2            // Tr?ng
 130   2            break;
 131   2          case 3:
 132   2            // Tr?ng
 133   2            break;
 134   2          case 4:
 135   2              // Tr?ng
 136   2              break;
 137   2          case 5:
 138   2              // Tr?ng
 139   2              break;
 140   2          case 6:
 141   2              // Tr?ng
 142   2              break;
 143   2          case 7:
 144   2              // Tr?ng
 145   2              break;
 146   2          case 8:
 147   2              module_8();
 148   2              break;
 149   2          case 9:
 150   2            // Tr?ng
 151   2            break;
 152   2          case 10:
 153   2            // Tr?ng
 154   2            break;
 155   2          case 11:
 156   2            // Tr?ng
 157   2            break;
 158   2          case 12:
 159   2            // Tr?ng
 160   2            break;
 161   2          case 13:
 162   2              // Tr?ng
 163   2              break;
 164   2          case 14:
 165   2              // Tr?ng
 166   2              break;
 167   2          case 15:
 168   2              // Tr?ng
 169   2              break;
 170   2          case 16:
 171   2              // Tr?ng
 172   2              break;
 173   2          case 17:
 174   2              // Tr?ng
 175   2              break;
 176   2          case 18:
 177   2              // Tr?ng
 178   2              break;
C51 COMPILER V9.60.0.0   DISPLAYLCD                                                        12/10/2023 13:06:45 PAGE 4   

 179   2          case 19:
 180   2              // Tr?ng
 181   2              break;
 182   2          case 20:
 183   2              // Tr?ng
 184   2              break;
 185   2          default:
 186   2              reset();
 187   2              break;
 188   2        }
 189   1      }
 190          
 191          void displayLCD(void){
 192   1        unsigned char i;
 193   1        LcdWriteCom(0x80); 
 194   1        for(i=0;i<9;i++)
 195   1        {
 196   2          LcdWriteData(CDIS1[i]); 
 197   2        }
 198   1        LcdWriteCom(0x80+0x40);
 199   1        for(i=0;i<9;i++)
 200   1        {
 201   2          LcdWriteData(CDIS2[i]); 
 202   2        }
 203   1      }
 204          
 205          void signalRecieved(void){
 206   1        unsigned char i;
 207   1        IrValue[4]=IrValue[2]>>4;
 208   1        IrValue[5]=IrValue[2]&0x0f; 
 209   1        if(IrValue[4]==0x00 && IrValue[5]==0x0D)
 210   1        {     //0   0D
 211   2          nutBam = 0;
 212   2          xuLi(nutBam);
 213   2        }
 214   1        if(IrValue[4]==0x00 && IrValue[5]==0x0C)
 215   1        { //1   0C  
 216   2          nutBam = 1;
 217   2          xuLi(nutBam);
 218   2        }
 219   1        if(IrValue[4]==0x01 && IrValue[5]==0x08)
 220   1        {   //2   18
 221   2          nutBam = 2;
 222   2          xuLi(nutBam);
 223   2        }
 224   1        if(IrValue[4]==0x05 && IrValue[5]==0x0E)
 225   1        {   //3   5E
 226   2          nutBam = 3;
 227   2          xuLi(nutBam);
 228   2        }
 229   1        if(IrValue[4]==0x00 && IrValue[5]==0x08)
 230   1        {     //4   08
 231   2          nutBam = 4;
 232   2          xuLi(nutBam);
 233   2        }
 234   1        if(IrValue[4]==0x01 && IrValue[5]==0x0C)
 235   1        { //5   1C  
 236   2          nutBam = 5;
 237   2          xuLi(nutBam);
 238   2        }
 239   1        if(IrValue[4]==0x05 && IrValue[5]==0x0A)
 240   1        {   //6   5A
C51 COMPILER V9.60.0.0   DISPLAYLCD                                                        12/10/2023 13:06:45 PAGE 5   

 241   2          nutBam = 6;
 242   2          xuLi(nutBam);
 243   2        }
 244   1        if(IrValue[4]==0x04 && IrValue[5]==0x02)
 245   1        {   //7   42
 246   2          nutBam = 7;
 247   2          xuLi(nutBam);
 248   2        }
 249   1        if(IrValue[4]==0x05 && IrValue[5]==0x02)
 250   1        {     //8   52
 251   2          nutBam = 8;
 252   2          xuLi(nutBam);
 253   2        }
 254   1        if(IrValue[4]==0x04 && IrValue[5]==0x0A)
 255   1        { //9   4A
 256   2          nutBam = 9;
 257   2          xuLi(nutBam);
 258   2        }
 259   1        
 260   1        if(IrValue[4]==0x04 && IrValue[5]==0x04)
 261   1        {   //mode    44H
 262   2          if(module < 20)
 263   2          {
 264   3            runModule(module);
 265   3          }
 266   2          else
 267   2          {
 268   3            LcdWriteCom(0x80+0x40);
 269   3            for(i=0;i<9;i++)
 270   3            {
 271   4              LcdWriteData(CDIS4[i]); 
 272   4            }
 273   3            DelayMs(7000);
 274   3          }
 275   2          //reset();
 276   2        }
 277   1        if(IrValue[4]==0x04 && IrValue[5]==0x06)
 278   1        {   //stop    46H
 279   2          LcdWriteCom(0x80+0x40);
 280   2          for(i=0;i<9;i++)
 281   2          {
 282   3            LcdWriteData(CDIS2[i]); //Hien thi 'IR-CODE:--H' len LCD
 283   3          }
 284   2          IrValue[2] = 0;
 285   2        }
 286   1        
 287   1        if(IrValue[4]==0x04 && IrValue[5]==0x05)
 288   1        {   //nguon   45H
 289   2          reset();
 290   2        }
 291   1      }
 292          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    941    ----
   CONSTANT SIZE    =     46    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     13      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.60.0.0   DISPLAYLCD                                                        12/10/2023 13:06:45 PAGE 6   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
