C51 COMPILER V9.01   MAIN                                                                  12/20/2013 09:02:28 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\KEIL\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*******************************************************************************
   2          * 实验名                           : 万年历实验
   3          * 使用的IO           : 
   4          * 实验效果       :1602显示时钟
   5          *       注意                                     ：
   6          *******************************************************************************/
   7          
   8          #include<reg51.h>
   9          #include"ds1302.h"
  10          
  11          //数码管IO
  12          #define DIG     P0
  13          sbit LSA=P2^2;
  14          sbit LSB=P2^3;
  15          sbit LSC=P2^4;
  16          
  17          unsigned char code DIG_CODE[10]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};
  18          unsigned char Num=0;
  19          unsigned int disp[8]={0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f};
  20          
  21          void LcdDisplay();
  22          void Timer0Configuration();
  23          
  24          /*******************************************************************************
  25          * 函数名         : main
  26          * 函数功能                 : 主函数
  27          * 输入           : 无
  28          * 输出           : 无
  29          *******************************************************************************/
  30          
  31          void main()
  32          {
  33   1              Ds1302Init();
  34   1          Timer0Configuration();
  35   1              while(1)
  36   1              {       
  37   2                      Ds1302ReadTime();
  38   2                      disp[7] = DIG_CODE[TIME[0]&0x0f];
  39   2                      disp[6] = DIG_CODE[TIME[0]>>4];
  40   2                      disp[5] = 0X40;
  41   2                      disp[4] = DIG_CODE[TIME[1]&0x0f];
  42   2                      disp[3] = DIG_CODE[TIME[1]>>4];
  43   2                      disp[2] = 0X40;
  44   2                      disp[1] = DIG_CODE[TIME[2]&0x0f];
  45   2                      disp[0] = DIG_CODE[TIME[2]>>4]; 
  46   2              }
  47   1              
  48   1      }
  49          
  50          /*******************************************************************************
  51          * 函数名         : Timer0Configuration()
  52          * 函数功能                 : 设置计时器
  53          * 输入           : 无
  54          * 输出           : 无
  55          *******************************************************************************/
C51 COMPILER V9.01   MAIN                                                                  12/20/2013 09:02:28 PAGE 2   

  56          
  57          void Timer0Configuration()
  58          {
  59   1              TMOD=0X02;//选择为定时器模式，工作方式2，仅用TRX打开启动。
  60   1      
  61   1              TH0=0X9C;       //给定时器赋初值，定时100us
  62   1              TL0=0X9C;       
  63   1              ET0=1;//打开定时器0中断允许
  64   1              EA=1;//打开总中断
  65   1              TR0=1;//打开定时器              
  66   1      }
  67          
  68          /*******************************************************************************
  69          * 函数名         : DigDisplay() interrupt 1
  70          * 函数功能                 : 中断数码管显示
  71          * 输入           : 无
  72          * 输出           : 无
  73          *******************************************************************************/
  74          
  75          void DigDisplay() interrupt 1
  76          {
  77   1      //定时器在工作方式二会自动重装初，所以不用在赋值。
  78   1      //      TH0=0X9c;//给定时器赋初值，定时1ms
  79   1      //      TL0=0X00;               
  80   1              DIG=0; //消隐
  81   1              switch(Num)      //位选，选择点亮的数码管，
  82   1              {
  83   2                      case(7):
  84   2                              LSA=0;LSB=0;LSC=0; break;
  85   2                      case(6):
  86   2                              LSA=1;LSB=0;LSC=0; break;
  87   2                      case(5):
  88   2                              LSA=0;LSB=1;LSC=0; break;
  89   2                      case(4):
  90   2                              LSA=1;LSB=1;LSC=0; break;
  91   2                      case(3):
  92   2                              LSA=0;LSB=0;LSC=1; break;
  93   2                      case(2):
  94   2                              LSA=1;LSB=0;LSC=1; break;
  95   2                      case(1):
  96   2                              LSA=0;LSB=1;LSC=1; break;
  97   2                      case(0):
  98   2                              LSA=1;LSB=1;LSC=1; break;       
  99   2              }
 100   1              DIG=disp[Num]; //段选，选择显示的数字。
 101   1              Num++;
 102   1              if(Num>7)
 103   1                      Num=0;
 104   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    239    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     17    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
